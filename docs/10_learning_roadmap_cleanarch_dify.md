# 学習ロードマップ（Clean Architecture + Dify）

作成日: 2026-02-10  
対象期間: 2026-02-10 〜 2026-05-31（約16週間）

---

## 1. 現在地（Python構築率の見積り）

### 全体評価（実装観点）
- **現在の構築率: 68%（目安）**

### 根拠（現状）
- テストは `54 passed`（主要ロジックは動作確認済み）
- Domain / Application / Infrastructure の基本骨格は存在
- ただし Presentation まわりに旧構成参照・未実装ファイルが残る
- 一部に空ファイル（将来実装予定の雛形）がある

### レイヤ別の目安
- Domain: 75%
- Application: 75%
- Infrastructure: 70%
- Presentation: 40%
- ドキュメント/運用: 70%

注記:
- この%は「学習を進めるための目安」です（絶対評価ではない）

---

## 2. 目標（今回の優先）

1. Clean Architecture を実装で説明できる状態にする  
2. n8n方針を Dify 方針へ切替し、最小プロダクトを作る  
3. AI活用を「補助」ではなく「開発プロセス」に組み込む

---

## 3. 学習方針（n8n -> Dify 切替）

### 方針
- **新規フロー開発は n8n ではなく Dify で実施**
- n8n は既存資産の読み取り/比較用途のみ（保守最小）
- Python 側は Clean Architecture を維持し、Dify接続は Adapter 経由で吸収

### 意図
- 今後の拡張（LLMワークフロー）を Dify に寄せる
- 既存 Python 資産を捨てずに接続層だけ差し替えられる設計を維持

---

## 4. 期間付きロードマップ

## Phase 1: 現行Python基盤の整流化（2026-02-10 〜 2026-02-29）

目的:
- Clean Architecture 学習の土台を安定化

やること:
- Presentation の旧参照 (`src.base` / `data.schema`) を現行構成へ整理
- 空ファイルの扱いを決める（実装する/削除する）
- 命名規則を運用ルール化（レビュー時チェック項目化）

完了条件:
- `pytest` 緑維持
- 「なぜ Port/Adapter が必要か」を説明できる
- ドキュメントと実コードの参照ズレが解消

---

## Phase 2: Clean Architecture 実装強化（2026-03-01 〜 2026-03-31）

目的:
- 「知っている」から「書ける」へ移行

やること:
- 状態遷移を伴う Entity サンプルを1本実装（draft -> submitted など）
- UseCase / Domain / Adapter の責務境界をテストで固定
- 例外系テストを追加（無効状態遷移、外部APIエラー）

完了条件:
- 状態遷移ルールを Domain で実装できる
- UseCase が外部SDKに直接依存しない
- レビュー時に責務混在を自力で検知できる

---

## Phase 3: Dify基礎導入（2026-04-01 〜 2026-04-20）

目的:
- Dify を触って基礎を理解し、1フロー動かす

やること:
- Dify の基本機能学習（Workflow / Prompt / Tools / Dataset）
- 既存ユースケースを Dify ワークフローで最小再現
- Python から Dify API を呼ぶための Port / Adapter 草案作成

完了条件:
- Dify 上で1本の業務フローが実行可能
- Python から Dify を呼び出す試作が動く

---

## Phase 4: Dify連携を本実装へ（2026-04-21 〜 2026-05-10）

目的:
- n8n代替としての実運用に近づける

やること:
- `TextGeneratorPort` 相当を Dify Adapter で実装
- 失敗時のリトライ/タイムアウト/ログ設計
- Dify出力を Domain 型へ正規化

完了条件:
- 既存 UseCase から Dify 経由で応答生成できる
- 失敗時挙動が定義・テスト済み

---

## Phase 5: 仕上げ（2026-05-11 〜 2026-05-31）

目的:
- 学習成果を再利用可能にする

やること:
- 構成図・判断基準・実装ガイドを docs に統合
- 「n8n版との比較メモ」を残して意思決定を固定
- 次四半期の改善計画（評価指標つき）を作成

完了条件:
- 他者に構成説明できるドキュメントが揃う
- 次に作る機能の設計テンプレがある

---

## 5. AI活用方針（開発プロセス）

## 5.1 使う場面
- 設計レビュー: 責務混在チェック
- テスト設計: 正常/異常/境界の抜け漏れ検出
- 実装補助: 雛形生成、命名提案、差分レビュー
- ドキュメント化: 図解・説明文の下書き生成

## 5.2 使い方ルール
- AI提案は必ず「根拠」と「責務境界」で採否判断
- 業務ルールの最終判断は人間が行う
- 生成コードは必ずテストで検証する

## 5.3 週次KPI（最低限）
- テスト通過率（維持）
- 追加テスト件数（週2件以上）
- docs更新回数（週1回以上）
- Dify検証ログ（週1本以上）

---

## 6. 学習の優先順位（迷ったとき）

1. Clean Architecture の責務境界を守る  
2. テストで挙動を固定する  
3. Difyへ段階的に移行する  
4. 最後に運用性（監視・ログ）を整える

---

## 7. 直近2週間の具体タスク（最初の一歩）

- `Presentation` の旧依存を整理する
- Dify接続用の Port 名を先に決める
- Dify Adapter の雛形を作る（実通信は後でOK）
- 変更点を毎日1行で worklog に残す

この4つが終わると、次フェーズへ滑らかに進める。

---

## 8. 2月末完了の実行計画（短期）

- 印刷用スプリント計画: `docs/11_february_sprint_plan.md`
